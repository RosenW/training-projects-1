<html lang="en">
  <head>
    <link href="./bootstrap.css" rel="stylesheet">
  </head>
   <body>
    <h2 class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center">Welcome, {{ user }}</h2>
    <ul class="list-group-item col-lg-offset-4 col-md-offset-4 col-sm-offset-4 col-xs-offset-4 col-lg-4 col-md-4 col-sm-4 col-xs-4">
      <form method="post" action="/home">
        <label for="apikey-box">Generate API key: </label>
        <br>
        <input type="text" id="apikey-box" name="apikey-box" disabled>
        <button id="copy-btn">Copy</button>
        <button type="submit" class="pull-right" id="generate-btn">Generate Key</button>
        <br>
        <br>
        <p>Your API keys:</p>
        <ul id="keys">
          {{#each keys}}
            <li>{{key}}</li>
          {{/each}}
        </ul>
        <br>
        <p class="pull-right"><a href="/logout">Log out</a></p>
        <p class="pull-left"><a href="/docs">Documentation</a></p>
      </form>
    </ul>
  </body>
</html>
<script type="text/javascript">
  const generateBtn = document.getElementById('generate-btn');
  const copyBtn = document.getElementById('copy-btn');

  copyBtn.addEventListener('click', async (event) => {
    event.preventDefault();
    const keyBox = document.getElementById('apikey-box');

    const el = document.createElement('textarea');
    el.value = keyBox.value;
    document.body.appendChild(el);
    el.select();
    document.execCommand('copy');
    document.body.removeChild(el);
  });

  generateBtn.addEventListener('click', async (event) => {
    event.preventDefault();
    const username = "{{user}}";
    const response = await fetch(
      '/generateKey',
    {
      headers: {
            "Content-Type": "application/json"
        },
      method : "POST",
      body: JSON.stringify({ name: username })
    });
    const keyObj = await response.json();
    document.getElementById('apikey-box').value = keyObj.key;
    const keyElement = document.createElement('li');
    keyElement.innerHTML = keyObj.key;
    document.getElementById('keys').appendChild(keyElement);
  });
</script>