<html lang="en">
  <head>
    <link href="./bootstrap.css" rel="stylesheet">
    <script type="text/javascript" src="jquery.min.js"></script>
    <script type="text/javascript" src="dalipeche.js"></script>
  </head>
   <body>
    <h2 class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center">Register</h2>
    <ul class="list-group-item col-lg-offset-4 col-md-offset-4 col-sm-offset-4 col-xs-offset-4 col-lg-4 col-md-4 col-sm-4 col-xs-4">
        <form method="post" action="/register">
          <label for="username">Username:</label>
          <input type="text" id='username' name='username' placeholder="Enter Your Username" class="form-control">
          <p id="username-err" hidden="true" class="text-danger">Username must be at least 3 symbols, only letters</p>
          <label for="username">Email:</label>
          <input type="email" id='email' name='email' placeholder="Enter Your Email" class="form-control">
          <label for="username">Password:</label>
          <input type="password" id='password' name='password' placeholder="Enter Your Password" class="form-control">
          <p id="password-err" hidden="true" class="text-danger">Password must be at least 3 symbols</p>
          <label for="username">Repeat Password:</label>
          <input type="password" id='repeat-password' name='repeat-password' placeholder="Repeat Your Password" class="form-control">
          <br>
          <p id="pass-err" hidden="true" class="text-danger">Passwords don't match</p>
          <p id="email-err" hidden="true" class="text-danger">Invalid Email</p>
          <p id="name-exists-err" hidden="true" class="text-danger">a user with this username already exists</p>
          <p id="email-exists-err" hidden="true" class="text-danger">a user with this email already exists</p>
          <br>
          <a href="./login">Already have an account ?</a>
          <input type="submit" id='sub-btn' class='btn btn-default pull-right' value="Register"></input>
        </form>
    </ul>
  </body>
</html>

<script type="text/javascript">
  const MINIMUM_PASS_LENGTH = 3;
  const usernameBox = document.getElementById('username');
  const passwordBox = document.getElementById('password');
  const repeatPasswordBox = document.getElementById('repeat-password');

  const passwordsDontMatchErrorMsg = document.getElementById('pass-err');
  const invalidEmailErrorMsg = document.getElementById('email-err');
  const usernameLengthErrorMsg = document.getElementById('username-err');
  const passwordLengthErrorMsg = document.getElementById('password-err');
  const usernameExistsErrorMsg = document.getElementById('name-exists-err');
  const emailExistsErrorMsg = document.getElementById('email-exists-err');

  const error = "{{err}}";

  usernameBox.addEventListener('keyup', checkUsernameField);
  passwordBox.addEventListener('keyup', checkPasswordFields);
  repeatPasswordBox.addEventListener('keyup', checkPasswordFields);

  if (Number(error) === 1) {
    usernameExistsErrorMsg.removeAttribute('hidden');
  }

  if (Number(error) === 2) {
    invalidEmailErrorMsg.removeAttribute('hidden');
  }

  if (Number(error) === 3) {
    emailExistsErrorMsg.removeAttribute('hidden');
  }

  function checkUsernameField () {
    if (usernameBox.value.length < MINIMUM_PASS_LENGTH) {
      usernameLengthErrorMsg.removeAttribute('hidden');
    } else {
      usernameLengthErrorMsg.setAttribute('hidden', 'true');
    }
  }

  function checkPasswordFields () {
    if (passwordBox.value.length < MINIMUM_PASS_LENGTH) {
      passwordLengthErrorMsg.removeAttribute('hidden');
    } else {
      passwordLengthErrorMsg.setAttribute('hidden', 'true');
    }

    if (passwordBox.value !== repeatPasswordBox.value) {
      passwordsDontMatchErrorMsg.removeAttribute('hidden');
    } else {
      passwordsDontMatchErrorMsg.setAttribute('hidden', 'true');
    }
  }
</script>
