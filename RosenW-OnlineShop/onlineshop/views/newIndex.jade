doctype html
html(lang='en')
  head
    meta(charset='utf-8')
    title Office Shop
    meta(name='viewport', content='width=device-width, initial-scale=1.0')
    meta(name='description', content='')
    meta(name='author', content='')
    // Bootstrap styles
    link(href='../assets/css/bootstrap.css', rel='stylesheet')
    // Customize styles
    link(href='../assets/css/style.css', rel='stylesheet')
    // font awesome styles
    link(href='../assets/font-awesome/css/font-awesome.css', rel='stylesheet')
    //if IE 7
      link(href='css/font-awesome-ie7.min.css', rel='stylesheet')
    //if lt IE 9
      script(src='http://html5shim.googlecode.com/svn/trunk/html5.js')
    // Favicons
    link(rel='shortcut icon', href='../assets/ico/favicon.ico')
  body
    //
      Lower Header Section
    .container
      //
        Navigation Bar Section
      include ./navbar.jade
      //
        Body Section
      .row
        .span12
          ul.breadcrumb
            li
              a(href='/') Home
              span.divider /
            li.active #{data.cname}
          .well.well-small
            h1
              | #{data.cname}
            hr.soften
            table.table.table-bordered.table-condensed
                tr
                    th(width="20%") Product
                    th(width="20%") Description
                    th(width="20%") Quantity in stock
                    th(width="15%") Price
                    if data.isLoggedIn && !data.isAdmin
                        th(width="10%") Quantity
                        th(width="10%") Add
                    if data.isAdmin
                        th(width="10%") Edit
                        th(width="10%") Delete
                    each item in data.prods
                        tr
                        td(style="text-align:center") #{item.name}
                            img(style="height: 200px; width: 100%" src="/images/#{item.img}")
                        td(style="text-align:left; vertical-align:top") #{item.description}
                        td(style="text-align:center") #{item.quantity}
                        td(align="right") $#{item.price}
                        if data.isLoggedIn && !data.isAdmin
                            td(style="text-align:center")
                                input(id="input-#{item.id}" type='text', placeholder='quant.', style='width: 50px', onkeyup="changeQuantity('#{item.id}', '#{item.quantity}')" ) 
                            td(style="text-align:center")
                                button.shopBtn.btn-large(onclick="add('#{item.id}')") add
                        if data.isAdmin
                            td(style="text-align:center")
                                button(onclick="location.href = '/edit/#{item.id}';") edit
                            td(style="text-align:center")
                                button(onclick="location.href = '/delete/#{item.id}';") delete    
            br
           
            a.shopBtn.btn-large(href='/')
              span.icon-arrow-left
              |  Continue Shopping
            a.shopBtn.btn-large.pull-right(href='/buy')
              | Next 
              span.icon-arrow-right

// Placed at the end of the document so the pages load faster
script(src='../assets/js/jquery.js')
script(src='../assets/js/bootstrap.min.js')
script(src='../assets/js/jquery.easing-1.3.min.js')
script(src='../assets/js/jquery.scrollTo-1.4.3.1-min.js')
script(src='../assets/js/shop.js')
         
script.
  //notify options
  let options = {
  // whether to hide the notification on click
  clickToHide: true,
  // whether to auto-hide the notification
  autoHide: true,
  // if autoHide, hide after milliseconds
  autoHideDelay: 5000,
  // show the arrow pointing at the element
  arrowShow: true,
  // arrow size in pixels
  arrowSize: 5,
  // position defines the notification position though uses the defaults below
  position: 'bottom right',
  // default style
  style: 'bootstrap',
  // default class (string or [string])
  className: 'success',
  // show animation
  showAnimation: 'slideDown',
  // show animation duration
  showDuration: 400,
  // hide animation
  hideAnimation: 'slideUp',
  // hide animation duration
  hideDuration: 200,
  // padding between element and notification
  gap: 0
  }
  //make link with black bg
  $('#nav-home').addClass('page');
  $('#nav-home').text('Back');

  //sorting
  function sortByQuantity(){
    console.log(data.prods);
  }

  //changes quantity to max allowed
  function changeQuantity(id, max){
    let quantityBox = $('#input-' + id);
    let value = quantityBox.val();
    if(Number(value)>max){
      quantityBox.val(max);
    }
  }

  function add(id){
    let box = $('#input-' + id);
    let textBoxValue = box.val();
    box.val("");
    if(isNumber(textBoxValue) && isWholeNumber(textBoxValue) && Number(textBoxValue)>0){
      $.post('/addtocart', {id: id, quant: textBoxValue});
      $('#navbar').notify('Product added to cart', options);
    }
  }
  
  function isNumber(n) {
    return !isNaN(parseFloat(n)) && isFinite(n);
  }

  function isWholeNumber(n){
    var result = (n - Math.floor(n)) !== 0; 
    if (result)
    return false;
    else
    return true;
  }
